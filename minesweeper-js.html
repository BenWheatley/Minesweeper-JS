<!DOCTYPE html>
<html>

<head>
<script>

let width = 3;
let height = 3;
let mineFraction = 0.1;

const State = {
	Unexplored: 'Unexplored',
	Flagged: 'Flagged',
	Open: 'Open'
};

class Cell {
	constructor(mined) {
		this.mined = mined;
		this.state = State.Unexplored;
	}
}

function makeShuffledMinefield() {
	let size = width * height;
	let mineCount = size * mineFraction;
	
	var result = new Array(size);
	
	for (var i=0; i<size; i++) {
		result[i] = new Cell(i < mineCount);
	}
	
	shuffleArray(result);
	
	return result;
}

var minefield = makeShuffledMinefield();

function createGrid() {
	var html = "";
	
	for (var y=0; y<height; y++) {
		for (var x=0; x<width; x++) {
			html += cellHTML(x, y);
		}
		html += "<br />";
	}
	
	document.getElementById('grid').innerHTML = html;
}

function cellID(x, y) {
	return `${x}-${y}`;
}

function cellHTML(x, y) {
	return `<button id="${cellID(x, y)}" onclick=\"tapInCell(${x},${y})\">‚¨úÔ∏è</button>`;
}

function tapInCell(x, y) {
	var index = y * width + x;
	let id = cellID(x, y);
	
	var html = "";
	if (minefield[index].mined) {
		html = "üí£";
	} else {
		let bytesPerSymbol = 3;
		html = "0Ô∏è‚É£1Ô∏è‚É£2Ô∏è‚É£3Ô∏è‚É£4Ô∏è‚É£5Ô∏è‚É£6Ô∏è‚É£7Ô∏è‚É£8Ô∏è‚É£".substr(surroundingMineCount(x, y) * bytesPerSymbol, bytesPerSymbol);
	}
	document.getElementById(id).innerHTML = html;
}

function flagCell(index) {
	return "üö©";
}

function surroundingMineCount(x, y) {
	var count = 0;
	
	for (var ty=y-1; ty<=y+1; ty++) {
		if (ty >= 0 && ty < height) {
			for (var tx=x-1; tx<=x+1; tx++) {
				let inMiddle = (tx == x && ty == y);
				if (tx >= 0 && tx < width && !(inMiddle)) {
					let t_index = ty * width + tx;
					if (minefield[t_index].mined) {
						count++;
					}
				}
			}
		}
	}
	
	return count;
}

function openAll() {
	for (var y=0; y<height; y++) {
		for (var x=0; x<width; x++) {
			tapInCell(x, y);
		}
	}
}

// shuffleArray function ‚Äî https://stackoverflow.com/a/12646864/3632488 ‚Äî CC BY-SA 4.0 ‚Äî StackOverflow users @"Laurens Holst" and @ashleedawg
function shuffleArray(array) {
	for (let i = array.length - 1; i > 0; i--) {
		const j = Math.floor(Math.random() * (i + 1));
		[array[i], array[j]] = [array[j], array[i]];
	}
}

</script>
</head>

<body onload="createGrid();">

<h1 style="font-family: Sans-serif;">Emojisweeper</h1>

<div id="grid" />

</body>
</html>
